(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,s=window.wp.blockEditor,n=window.wp.components,o=window.wp.element,i=window.wp.apiFetch;var r=e.n(i);const a=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"dmg/read-more","title":"DMG Read More","category":"common","icon":"admin-links","description":"A block to display a \'Read More\' link to a selected post.","attributes":{"postId":{"type":"number","default":0},"postTitle":{"type":"string","default":""},"postLink":{"type":"string","default":""}},"editorScript":"file:./build/index.js","editorStyle":"file:./build/index.css"}'),l=window.ReactJSXRuntime;(0,t.registerBlockType)(a,{edit:function({attributes:e,setAttributes:t}){const i=(0,s.useBlockProps)(),[a,d]=(0,o.useState)(""),[c,p]=(0,o.useState)(""),[u,h]=(0,o.useState)([]),[x,m]=(0,o.useState)(1),[y,g]=(0,o.useState)(1),[j,b]=(0,o.useState)(!1),[w,f]=(0,o.useState)(null),k=async(e="",t="",s=1)=>{b(!0),f(null);try{let n=`/wp/v2/posts?per_page=10&page=${s}&status=publish`;e&&(n+=`&search=${encodeURIComponent(e)}`),t&&(n+=`&include=${t}`);const o=await r()({path:n,method:"GET",parse:!1}),i=await o.json();h(Array.isArray(i)?i:[]),g(parseInt(o.headers.get("X-WP-TotalPages")||1))}catch(e){console.error("Error fetching posts:",e),f("Failed to fetch posts. Please try again."),h([]),g(1)}finally{b(!1)}};(0,o.useEffect)(()=>{k("","",1)},[]);const v=(e,t)=>{"title"===t?(d(e),p("")):(p(e),d("")),m(1),k("title"===t?e:"","id"===t&&e.match(/^\d+$/)?e:"",1)},S=e=>{m(e),k(a,c,e)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.InspectorControls,{children:(0,l.jsxs)(n.PanelBody,{title:"Post Selection",children:[(0,l.jsx)(n.TextControl,{label:"Search by Post Title",value:a,onChange:e=>v(e,"title")}),(0,l.jsx)(n.TextControl,{label:"Search by Post ID",value:c,onChange:e=>v(e,"id")}),j&&(0,l.jsx)("p",{children:"Loading..."}),w&&(0,l.jsx)("p",{style:{color:"red"},children:w}),!j&&!w&&0===u.length&&(0,l.jsx)("p",{children:"No posts found."}),!j&&!w&&u.length>0&&(0,l.jsx)("div",{children:u.map(e=>(0,l.jsxs)(n.Button,{variant:"secondary",onClick:()=>(e=>{t({postId:e.id,postTitle:e.title.rendered,postLink:e.link}),d(""),p(""),m(1),k("","",1)})(e),style:{display:"block",margin:"5px 0",textAlign:"left"},children:[e.title.rendered," (ID: ",e.id,")"]},e.id))}),(0,l.jsxs)("div",{style:{marginTop:"10px"},children:[(0,l.jsx)(n.Button,{variant:"secondary",disabled:x<=1||j,onClick:()=>S(x-1),children:"Previous"}),(0,l.jsx)(n.Button,{variant:"secondary",disabled:x>=y||j,onClick:()=>S(x+1),children:"Next"}),(0,l.jsxs)("p",{style:{display:"inline",margin:"0 10px"},children:["Page ",x," of ",y]})]})]})}),(0,l.jsx)("div",{...i,children:e.postId?(0,l.jsxs)("p",{className:"dmg-read-more",children:["Read More: ",(0,l.jsx)("a",{href:e.postLink,children:e.postTitle})]}):(0,l.jsx)("p",{children:"Select a post from the sidebar."})})]})},save:function({attributes:e}){return e.postId?(0,l.jsxs)("p",{className:"dmg-read-more",children:["Read More: ",(0,l.jsx)("a",{href:e.postLink,children:e.postTitle})]}):null}})})();